<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <title>My Wishlist</title>
</head>

<>

    <div class="top-container">
        <div class="container-fluid">
            <div class="row py-3">
                <div class="col-md-4 col-12 text-center">
                    <div class="logo-container">
                        <img class="paw1" src="./images/paw.png" alt="paw">
                        <p>Pawsome Pets</p>
                        <img class="paw2" src="./images/paw.png" alt="paw">
                    </div>
                </div>

                <div class="col-md-6 col-12 text-center">
                    <div class="nav-container">
                        <a href="" class="active mx-3">Home</a>
                        <a href="" class="mx-3">Adopt a Pet</a>
                        <a href="" class="mx-3">About Us</a>
                        <a href="" class="mx-3">Contact Us</a>
                    </div>
                </div>

                <div class="col-md-2 col-12 text-left">
                    <div class="login-container">
                        <div class="profile">
                            <img src="./images/defaultprofile.png" alt="profile pic">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>




    <div class="container-fluid">
        <div class="row">
            <div class="col-4">
                <div class="left">
                    <p>My Wishlist</p>
                    <form class="wishlist-input" th:action="@{/wishlists}" method="post"
                        class="d-flex align-items-center">
                        <div class="input-container flex-grow-1">
                            <input type="text" id="newWishlistName" name="wishlistName" required="">
                            <label for="newWishlistName" class="label">Wishlist Name</label>
                            <div class="underline"></div>
                        </div>
                        <button type="submit">+</button>
                    </form>

                    <div class="mid" th:each="wishlist : ${wishlists}">
                        <form class="list-items" th:object="${wishlist}"
                            th:action="@{'/wishlists/' + ${wishlist.wishlistID}}" method="post">
                            <button class="wishlistname-button" type="button" onclick="showPets(this)"
                                th:attr="data-wishlist-id=${wishlist.wishlistID}">
                                <span th:id="'wishlistName-' + ${wishlist.wishlistID}"
                                    th:text="${wishlist.wishlistName}" th:unless="${isEditing}"></span>
                            </button>
                            <button id="edit-button" class="edit-button" type="button" onclick="enterEditMode(this)"
                                th:unless="${isEditing}"><img src="images/edit-coral.png">E</button>
                            <button id="delete-button" class="delete-button" type="submit" value="Delete"
                                onclick="return confirm('Are you sure you want to delete this wishlist?');"><img
                                    src="images/delete-coral.png">S</button>
                        </form>
                        <!-- <form th:action="@{'/wishlists/' + ${wishlist.wishlistID} + '/delete'}" method="post">
                            <button class="delete-button" type="submit" value="Delete"
                                onclick="return confirm('Are you sure you want to delete this wishlist?');"><img
                                    src="images/delete-coral.png">S</button>
                        </form> -->
                    </div>
                </div>

            </div>
            <div class="col-8">
                <div id="petsContainer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-8">
                                <h3 id="selectedWishlistName">Hello</h3>
                            </div>
                        </div>
                        <div class="row">

                        </div>
                    </div>

                    <ul id="selectedWishlistPets">
                    </ul>
                </div>


            </div>


        </div>
    </div>



    <script th:inline="javascript">
        // Initialize the selectedWishlistId to null
        var selectedWishlistId = null;

        function editWishlistName(spanElement) {
            const span = spanElement;
            const li = span.parentElement;

            const input = document.createElement("input");
            input.type = "text";
            input.name = "wishlistName"; // Set the input field name
            input.value = span.textContent;
            input.required = true;

            const saveButton = document.createElement("button");
            saveButton.type = "submit";
            saveButton.setAttribute('id', 'saveButton')
            // saveButton.textContent = "+";
            saveButton.classList.add("save-button");

            const cancelButton = document.createElement("button");
            cancelButton.type = "button";
            // cancelButton.textContent = "x";
            cancelButton.classList.add("cancel-button");
            cancelButton.setAttribute('id', 'cancelbutton')
            cancelButton.onclick = function () {
                showButton()
                li.replaceChild(span, input);
                li.removeChild(saveButton);
                li.removeChild(cancelButton);
            };

            li.replaceChild(input, span);
            li.appendChild(saveButton);
            li.appendChild(cancelButton);
        }

        function enterEditMode(buttonElement) {
            const editButton = buttonElement;
            const li = editButton.parentElement;
            const span = li.querySelector("span");
            editWishlistName(span);
            
            hideButtons()
        }

        function hideButtons() {
            const elementsToHide = [document.getElementById('edit-button'), document.getElementById('delete-button')]
            for (i=0; i<2; i++) {
                elementsToHide[i].hidden = true
            }
        }

        function showButton() {
            const elementsToHide = [document.getElementById('edit-button'), document.getElementById('delete-button')]
            for (i=0; i<2; i++) {
                elementsToHide[i].hidden = false
            }
        }

        function showPets(buttonElement) {
            const wishlistId = buttonElement.getAttribute("data-wishlist-id");
            const selectedWishlistName = document.getElementById("selectedWishlistName");
            const selectedWishlistPets = document.getElementById("selectedWishlistPets");

            // AJAX request to fetch the pet IDs for the selected wishlist
            fetch('/wishlists/' + wishlistId + '/pets')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(petIds => {
                    console.log("Response petIds:", petIds); // To check the petIds received in the response

                    // Update the heading with the name of the selected wishlist
                    const wishlistName = buttonElement.querySelector("span").textContent;
                    selectedWishlistName.textContent = wishlistName;

                    // Update the HTML to display pet IDs for the selected wishlist
                    selectedWishlistPets.innerHTML = ""; // Clear the previous pet IDs
                    petIds.forEach(petId => {
                        const petIdItem = document.createElement("li");
                        petIdItem.textContent = petId;
                        selectedWishlistPets.appendChild(petIdItem);
                    });
                })
                .catch(error => {
                    console.error("Error fetching pet IDs:", error);
                });
        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"
        crossorigin="anonymous"></script>
</body>

</html>